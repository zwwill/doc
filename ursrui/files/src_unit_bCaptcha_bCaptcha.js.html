<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>src/unit/bCaptcha/bCaptcha.js - URS RUI</title>
  
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-smart" _assetsPath="../assets">
 <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
               <a class="navbar-brand mainlogo" href="/urs-rui/doc/">
             
            <img alt="URS RUI" src="../assets/img/logo.png" title="URS RUI">
            
          </a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                 <ul class="nav navbar-nav">
                    
                    <li><a href="/urs-rui/doc/ui-standard/index.html">URS UI规范</a>
                    </li>
                    
                    <li><a href="https://g.hz.netease.com/urs-front/urs-rui">GitLab</a>
                    </li>
                    
                    <li><a href="http://npm.hz.netease.com/package/@netease/urs-rui">NPM</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </nav>
    <div id="sidebar">
    <h3>元件 / 模块</h3>
        <div id="api-tabview-filter">
            <input id='txtSearch' type="search" class="form-control" placeholder="Type to Filter Components">
        </div>
        <dl id="sidebar_list">
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <p>Module</p>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/H5MbInput.html">H5MbInput</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/H5Tab.html">H5Tab</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/bMbInput.html">bMbInput</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/PwdInput.html">PwdInput</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/SmsInput[待整理].html">SmsInput[待整理]</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <p>Sass</p>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/bCommon.scss.html">bCommon.scss</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/_config.scss.html">_config.scss</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <p>Unit</p>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/Alert.html">Alert</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Button.html">Button</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Captcha.html">Captcha</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Gotop.html">Gotop</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/bInput.html">bInput</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Loading.html">Loading</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Menu.html">Menu</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Pager.html">Pager</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Quest.html">Quest</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/SelectInput.html">SelectInput</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Slide.html">Slide</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Tab.html">Tab</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Toast.html">Toast</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
        </dl>
</div>
   
    <div class="stdoc-content">
        <div class="apidocs">
            <div id="docs-main">
                <div class="content">
                    <div class="page-header">
    <h1>src/unit/bCaptcha/bCaptcha.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums" id='src_code'>
/**
 * **单元组件 - 验证码[Captcha]**&lt;br&gt;
 * 基础的验证码封装组件&lt;br&gt;
 * 支持滑块验证码，点击式验证码功能&lt;br&gt;
 * **使用方法：**&lt;br&gt;
 * &#x60;&#x60;&#x60;
 * 【引用关键字】
 * require(&#x27;urs-rui/src/unit/bCaptcha/bCaptcha.js&#x27;)
 * &#x60;&#x60;&#x60;
 * &#x60;&#x60;&#x60;
 * 【组件标签】
 * &lt;bCaptcha clazz=&quot;u-ipt&quot; ref=bCaptcha captchaType={capType}&gt;&lt;/bCaptcha&gt;
 *
 * &#x60;&#x60;&#x60;
 * @class Captcha
 * @main Unit
 * @constructor
 * @demo unit/bCaptcha/demo-1.html {滑块验证码}
 * @demo unit/bCaptcha/demo-2.html {点击式验证码}
 * @demo unit/bCaptcha/demo-3.html {嵌入式}
 * @show true
 * @author cheng-lin@corp.netease.com
 */

/*================组件可传参数==================*/

/**
 * 验证码外层样式
 * @property clazz
 * @default 2
 * @type String
 */

/**
 * 验证码类型
 * @property captchaType
 * @default 2
 * @type String
 */

/**
 * 验证码文案是否居中
 * @property alignToSpace
 * @default true
 * @type Boolean
 */

/**
 * 验证码静态资源请求地址
 * @property staticServer
 * @default captcha.reg.163.com/v2
 * @type String
 */

/**
 * 验证码后端验证请求地址
 * @property apiServer
 * @default captcha.reg.163.com/v2
 * @type String
 */

/**
 * 验证码Id
 * @property captchaId
 * @default 01af5fbb3c62da409236694547396158
 * @type String
 */

/**
 * 验证码宽度
 * @property width
 * @default document.body.clientWidth * 0.9
 * @type Number
 */

/**
 * 是否使用https
 * @property forceHttps
 * @default false
 * @type Boolean
 */

/**
 * 显示延迟时间
 * @property showDelay
 * @default 300
 * @type Number
 */

/**
 * 隐藏延迟时间
 * @property hideDelay
 * @default 0
 * @type Number
 */

/*================可发起/监听事件==================*/
/**
 * 验证码验证结果
 * @event validate
 * @example &lt;bCaptcha on-validate={ function(_obj){} } /&gt;
 * @return {Object}
 */
/**
 * 验证码初始化成功
 * @event initCallback
 * @example &lt;bCaptcha on-initCallback={ function(_obj){} } /&gt;
 * @return {Object}
 */
/**
 * 验证码初始化失败
 * @event initErrorHandler
 * @example &lt;bCaptcha on-initErrorHandler={ function(_obj){} } /&gt;
 * @return {Object}
 */
&#x27;use strict&#x27;

import Base from &#x27;../../base/component&#x27;
import tpl from &#x27;./bCaptcha.html&#x27;;
import &#x27;./bCaptcha.scss&#x27;;

let data = {};

const wd = document.body.clientWidth &lt; 425 ? parseInt(document.body.clientWidth * 0.92,10):391;

let capOpt = {
    &#x27;alignToSpace&#x27;:true,
    &#x27;staticServer&#x27;:&#x27;captcha.reg.163.com/v2&#x27;,
    &#x27;apiServer&#x27;:&#x27;captcha.reg.163.com/v2&#x27;,
    &#x27;captchaId&#x27;:&#x27;01af5fbb3c62da409236694547396158&#x27;,
    &#x27;width&#x27;:wd,
    &#x27;mode&#x27;:&#x27;float&#x27;, // 嵌入 emit
    &#x27;forceHttps&#x27;:false,
    &#x27;showDelay&#x27;:300,
    &#x27;hideDelay&#x27;:0
};

let Captcha = Base.extend({
    template:tpl,
    name:&#x27;bCaptcha&#x27;,
    data:{
        &#x27;mode&#x27;:&#x27;float&#x27;,
        &#x27;hasError&#x27;:false
    },
    config:function(){
        this.data = Object.assign(data,this.data);
        this.data.capPaddingTop = 0 ;
        this.data.rules = [
            {type:&#x27;method&#x27;,trigger:&#x27;submit&#x27;,message:&#x27;&#x27;, options: (value) =&gt; 
            value &amp;&amp; value != &#x27;LG42Dm53vsrZmrXdZ6buHUVNfQcsLzql1gV7HFhl5yZzlILOJmPEY+r+vJComfirFG2deb709GYQQIob6ke6c31j6W+FKrE6QEghCshv5Kc=&#x27;}
        ]
    },
    /**
     * 获取验证码对错
     * @method validate
     * @return Boolean
     */
    validate (){
        this.data.hasError = !this.data.result;
        this.$update();
        this.$emit(&#x27;validate&#x27;,{result:this.data.result});
        let ret = {success:!this.data.hasError,msg:this.data.errorTip};
        return ret;
    },
    init:function(){
        capOpt = Object.assign(capOpt,data);
        this.data.capPaddingTop = capOpt.mode == &#x27;embed&#x27;? capOpt.width * 0.35 : 0 ;
        this.createOpt();
        this.data.errorTip = this.data.captchaType == &#x27;2&#x27; ? &#x27;请滑动验证码&#x27;:&#x27;请点击验证码&#x27;;
        this.captcha = new window.NECaptcha(capOpt);
    },
    createOpt:function(){
        capOpt.captchaType = this.data.captchaType||2;
        capOpt.element = this.$refs.slideCapBox;
        capOpt.verifyCallback = this.verifyCallback.bind(this);
        capOpt.initCallback = this.initCallback.bind(this);
        capOpt.initErrorHandler = this.initErrorHandler.bind(this);
    },
    verifyCallback:function(_result){
        this.data.cap = this.captcha &amp;&amp; this.captcha.getPwd();
        this.data.result = _result &amp;&amp; _result.value;
        this.onValidate();
    },
    initCallback:function(_result){
        this.$emit(&#x27;initCallback&#x27;,_result);
    },
    initErrorHandler:function(_result){
        this.$emit(&#x27;initErrorHandler&#x27;,_result);
    },
    onValidate:function(){
        this.data.hasError = !this.data.result;
        this.$update();
        return !this.data.hasError;
    },
    getPwd:function(){
        return this.captcha.getPwd();
    },
    /**
     * 重置验证码
     * @method reset
     * @param {String} type 验证码类型 ** *2滑块* | 3点击式**
     * @return undefined
     */
    reset:function(_type){
        this.data.hasError = 0;
        capOpt.captchaType = _type;
        this.data.errorTip = capOpt.captchaType == &#x27;2&#x27; ? &#x27;请滑动验证码&#x27;:&#x27;请点击验证码&#x27;;
        this.data.result = 0;
        if (!this.captcha){
            this.captcha = new window.NECaptcha(capOpt);
        }else{
            this.captcha.refresh(capOpt);
        }
    },
    /**
     * 显示错误提示
     * @method showError
     * @param {String} txt 错误提示 ** *错误提示**
     * @return undefined
     */
    showError:function(_txt){
        this.data.errorTip = _txt;
        this.data.hasError = 1;
        this.$update();
    }
})

module.exports = Captcha;

    </pre>
</div>

                </div>
            </div>
        </div>
    </div>
<a id="gotoTop" class='well well-small' href='#'>
    Top
</a>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/config.js"></script>
<script src="../assets/js/doc.js"></script>
</body>
</html>
