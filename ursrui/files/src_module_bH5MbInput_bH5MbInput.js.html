<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>src/module/bH5MbInput/bH5MbInput.js - URS RUI</title>
  
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-smart" _assetsPath="../assets">
 <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
               <a class="navbar-brand mainlogo" href="/urs-rui/doc/">
             
            <img alt="URS RUI" src="../assets/img/logo.png" title="URS RUI">
            
          </a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                 <ul class="nav navbar-nav">
                    
                    <li><a href="/urs-rui/doc/ui-standard/index.html">URS UI规范</a>
                    </li>
                    
                    <li><a href="https://g.hz.netease.com/urs-front/urs-rui">GitLab</a>
                    </li>
                    
                    <li><a href="http://npm.hz.netease.com/package/@netease/urs-rui">NPM</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </nav>
    <div id="sidebar">
    <h3>元件 / 模块</h3>
        <div id="api-tabview-filter">
            <input id='txtSearch' type="search" class="form-control" placeholder="Type to Filter Components">
        </div>
        <dl id="sidebar_list">
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <p>Module</p>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/H5MbInput.html">H5MbInput</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/H5Tab.html">H5Tab</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/bMbInput.html">bMbInput</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/PwdInput.html">PwdInput</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/SmsInput[待整理].html">SmsInput[待整理]</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <p>Sass</p>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/bCommon.scss.html">bCommon.scss</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/_config.scss.html">_config.scss</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <p>Unit</p>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/Alert.html">Alert</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Button.html">Button</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Captcha.html">Captcha</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Gotop.html">Gotop</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/bInput.html">bInput</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Loading.html">Loading</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Menu.html">Menu</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Pager.html">Pager</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Quest.html">Quest</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/SelectInput.html">SelectInput</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Slide.html">Slide</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Tab.html">Tab</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Toast.html">Toast</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
        </dl>
</div>
   
    <div class="stdoc-content">
        <div class="apidocs">
            <div id="docs-main">
                <div class="content">
                    <div class="page-header">
    <h1>src/module/bH5MbInput/bH5MbInput.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums" id='src_code'>
/**
 * **模块组件 - 移动端专用的国际手机号输入框[bH5MbInput]**&lt;br&gt;
 * 基础的按钮封装组件&lt;br&gt;
 * 支持按钮上锁、loading、倒计时功能&lt;br&gt;
 * **使用方法：**&lt;br&gt;
 * &#x60;&#x60;&#x60;
 * 【引用关键字】
 * require(&#x27;@netease/urs-rui/src/module/bH5MbInput/bH5MbInput.js&#x27;)
 * &#x60;&#x60;&#x60;
 * &#x60;&#x60;&#x60;
 * 【组件标签】
 * &lt;bH5MbInput  i18nMb={true} /&gt;
 *
 * &#x60;&#x60;&#x60;
 * @class H5MbInput
 * @module Module
 * @constructor
 * @demo module/bH5MbInput/demo-1.html {国际手机号}
 * @demo module/bH5MbInput/demo-2.html {国内手机号}
 * @demo module/bH5MbInput/demo-3.html {组件方法}
 * @show true
 */

/*================组件可传参数==================*/
/**
 * 输入框提示语
 * @property placeholder
 * @default 请输入手机号
 * @type String
 */
/**
 * 输入最大长度
 * @property maxLength
 * @default 20
 * @type Number
 */
/**
 * 是否支持国际手机号
 * @property i18nMb
 * @default false
 * @type boolean
 */

/*================可发起/监听事件==================*/

&#x27;use strict&#x27;

import &#x27;./bH5MbInput.scss&#x27;
import tpl from &#x27;./bH5MbInput.rgl&#x27;

import Base from &#x27;../../unit/bInput/bInput&#x27;;

export default Base.extend({
    name: &#x27;bH5MbInput&#x27;,
    template: tpl,
    data:{
        placeholder:&#x27;请输入手机号&#x27;,
        maxLength : 20,
        i18nMb:false, //支持国际手机号
        flagLock : false,
        flagCode : &quot;&quot;,
        flagClass : &quot;flag-CN&quot;,
    },
    config:function(_data){
        this.supr();
        this.rules0 = _data.rules;
        this.rules4i18n = _data.rules2;
        this.__body = document.body || document.getElementsByTagName(&#x27;body&#x27;)[0]
    },
    /**
     * 获取手机号码，国际手机号模式下返回格式【1-1234567】，在国内手机号模式下返回格式【13000000163】
     * @method getValue
     * @return String
     */
    getValue:function(){
        var _mb =  this.$refs.inputField.data.value;
        if(_mb &amp;&amp; this.data.flagCode &amp;&amp; this.data.flagCode != &quot;+86-&quot;){
            _mb = this.data.flagCode.replace(/\+/,&#x27;&#x27;) + _mb;
        }else{
            _mb;
        }
        return _mb;

    },
    /**
     * 设置普通国内手机号码
     * @method setValue
     * @param {String} _val 格式【1300000163】
     * @return Undefined
     */
    setValue:function (_val) {

        if(this.data.flagCode !== &#x27;+86-&#x27;){

            this.data.flagCode = &#x27;+86-&#x27;;
            this.data.flagClass = &#x27;flag-CN&#x27;;
        }
        this.$refs.inputField.data.value = _val;
        this.$update();
    },
    /**
     * 设置全手机号码
     * @method setFullValue
     * @param {String} _data 格式【+86-|1300000163|flag-CN】
     * @return Undefined
     */
    setFullValue:function(_data){
        var _values = _data.split(&#x27;|&#x27;);
        this.data.flagCode = _values[0];
        this.$refs.inputField.data.value  = _values[1];
        this.data.flagClass = _values[2];
        this.$update();
    },
    /**
     * 获取手机号码全信息，包括code、number和class
     * @method getFullValue
     * @return String
     */
    getFullValue:function(){
        var _vl = this.$refs.inputField.data.value;
        return _vl ? (this.data.flagCode + &#x27;|&#x27; + _vl + &#x27;|&#x27; + this.data.flagClass ) : &quot;&quot;;
    },
    onChangeC:function(_event){
        // this.__scrollTop = document.documentElement.scrollTop || document.body.scrollTop || window.pageYOffset || 0;
        // this.__body.style.top = - this.__scrollTop + &#x27;px&#x27;;
        // this.__body.style.position = &#x27;fixed&#x27;;
        this.data.chooseFlag = true;
        this.data.chooseFlagHide = false;
        this.$update();
    },
    onChooseC:function(_event){

        // this.__body.style.position = &#x27;&#x27;;
        // this.__body.style.top = &#x27;&#x27;;
        // document.documentElement.scrollTop =  document.body.scrollTop = this.__scrollTop || 0;

        var _target =_event.target,
            _code =  _target.dataset.code;
        if(!!_code){
            this.data.flagCode = _code;
            this.data.flagClass = _target.className;
            this.data.rules = _code==&#x27;+86-&#x27;? this.rules0:this.rules4i18n;
        }
        this.clearError.call(this.$refs.inputField);
        this.data.chooseFlagHiding = true;
        setTimeout(()=&gt;{
            this.data.chooseFlagHide = true;
            this.data.chooseFlagHiding = false;
            this.$update();
        },300);
        this.$update();
    },
    hideChooseFlag:function () {

    },
    /**
     * 国内手机号锁定操作
     * @method bindMobile
     * @param {String} _value 格式【1300000163】，当值为空时，为解锁操作
     * @return Undefined
     */
    bindMobile:function(_value){
        if(!!_value) {
            this.data.flagLock = true;
            this.setValue(_value);
        }else if(this.data.flagLock){
            this.data.flagLock = false;
            this.$refs.inputField.data.value = &quot;&quot;;
        }
        this.$update();
    },
    handleEvent(_t,_e){
        this.$emit(_t,_e);
    },

    /**
     * 校验输入框
     * @method focus
     * @return undefined
     */
    validate(trigger=&#x27;blur&#x27;) {
        // let rules = this.data.rules.filter((rule)=&gt;{
        //     return (rule.trigger!==&#x27;submit&#x27;);
        // });
        let rules = this.data.rules;
        let ret = {success:1,msg:&#x27;&#x27;};
        // 提交校验需要验证是否非空
        // @NOTE 非空校验单独提取 默认非空
        if(trigger === &#x27;submit&#x27;){
            if((this.data.require &amp;&amp; this.$refs.inputField.data.value === &#x27;&#x27;)){
                ret.success = 0;
                ret.msg = this.data.rqMsg;
                this.data.showErr&amp;&amp;this.showError.call(this.$refs.inputField,ret.msg);
                return ret;
            }
        }
        for (var i = 0; i &lt; rules.length; i++) {
            if(rules[i].rule instanceof RegExp){
                let result = rules[i].rule.test(this.getValue());
                // 反向校验，符合该正则时失败
                if(rules[i].type === &#x27;isNot&#x27;){
                    result = !result;
                }
                // 校验失败
                if(!result){
                    ret.success = 0;
                    ret.msg = rules[i].msg;
                    this.data.showErr&amp;&amp;this.showError.call(this.$refs.inputField,ret.msg);
                    // @NOTE 正则错误的提前退出一定是同步的
                    break;
                }
            }else if(typeof rules[i].rule == &#x27;function&#x27;){
                ret.success = rules[i].rule.call(this, this.getValue());
                ret.msg = rules[i].msg;
                if(!ret.success){
                    this.data.showErr&amp;&amp;this.showError.call(this.$refs.inputField,ret.msg);
                    break;
                }
            }
        }
        this.$emit(&#x27;validate&#x27;,ret);
        return ret;
    }
});


    </pre>
</div>

                </div>
            </div>
        </div>
    </div>
<a id="gotoTop" class='well well-small' href='#'>
    Top
</a>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/config.js"></script>
<script src="../assets/js/doc.js"></script>
</body>
</html>
